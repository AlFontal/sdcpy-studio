<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
  <link rel="shortcut icon" href="/static/favicon.svg" />
  <link rel="stylesheet" href="/static/app.css" />
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" defer></script>
  <script src="/static/app.js" defer></script>
</head>
<body>
  <div class="bg-grid" aria-hidden="true"></div>
  <main class="page">
    <section class="hero card">
      <div class="hero-copy">
        <div class="hero-title-row">
          <div class="hero-title">
            <img class="hero-logo" src="/static/sdcpy_logo_black.png" alt="sdcpy logo" />
            <h1>sdc-studio</h1>
          </div>
          <div class="hero-repo-stack" aria-label="project links">
            <a
              class="hero-repo-chip"
              href="https://github.com/AlFontal/sdcpy-studio"
              target="_blank"
              rel="noreferrer noopener"
            >
              <span class="hero-repo-icon" aria-hidden="true">
                <svg viewBox="0 0 16 16" role="img" focusable="false">
                  <path d="M8 0C3.58 0 0 3.58 0 8a8 8 0 0 0 5.47 7.59c.4.07.55-.17.55-.38v-1.33c-2.23.49-2.7-.95-2.7-.95-.36-.92-.89-1.16-.89-1.16-.73-.5.06-.49.06-.49.81.06 1.23.83 1.23.83.72 1.22 1.89.87 2.35.66.07-.52.28-.87.5-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82a7.5 7.5 0 0 1 4 0c1.53-1.03 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.28.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48v2.2c0 .21.15.46.55.38A8 8 0 0 0 16 8c0-4.42-3.58-8-8-8Z" />
                </svg>
              </span>
              <span class="hero-repo-copy">
                <strong>Web app</strong>
                <span>AlFontal/sdcpy-studio</span>
              </span>
            </a>
            <a
              class="hero-repo-chip"
              href="https://github.com/AlFontal/sdcpy"
              target="_blank"
              rel="noreferrer noopener"
            >
              <span class="hero-repo-icon" aria-hidden="true">
                <svg viewBox="0 0 16 16" role="img" focusable="false">
                  <path d="M8 0C3.58 0 0 3.58 0 8a8 8 0 0 0 5.47 7.59c.4.07.55-.17.55-.38v-1.33c-2.23.49-2.7-.95-2.7-.95-.36-.92-.89-1.16-.89-1.16-.73-.5.06-.49.06-.49.81.06 1.23.83 1.23.83.72 1.22 1.89.87 2.35.66.07-.52.28-.87.5-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82a7.5 7.5 0 0 1 4 0c1.53-1.03 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.28.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48v2.2c0 .21.15.46.55.38A8 8 0 0 0 16 8c0-4.42-3.58-8-8-8Z" />
                </svg>
              </span>
              <span class="hero-repo-copy">
                <strong>Python Engine</strong>
                <span>AlFontal/sdcpy</span>
              </span>
            </a>
          </div>
        </div>
        <p>
          Web application for interactive scale-dependent correlation analysis of time series.
        </p>
      </div>
    </section>

    <section class="layout">
      <article class="card span-12 workflow-tabs-card" data-testid="workflow-tabs-card">
        <div class="mode-switch workflow-switch" role="tablist" aria-label="Workflow tabs">
          <button
            id="workflow_tab_sdc"
            class="mode-btn is-active"
            role="tab"
            type="button"
            aria-selected="true"
            aria-controls="workflow_sdc"
          >
            2-Way SDC
          </button>
          <button
            id="workflow_tab_map"
            class="mode-btn"
            role="tab"
            type="button"
            aria-selected="false"
            aria-controls="workflow_map"
          >
            SDC Map (beta)
          </button>
        </div>
      </article>

      <article class="card span-12 workflow-sdc" data-testid="dataset-workflow-card">
        <details id="input_workflow_details" data-testid="input-workflow-details" class="settings-details" open>
          <summary>Input Workflow</summary>
          <p class="hint">
            Load a dataset from CSV file or paste values directly. 
          </p>
          <div class="mode-switch" role="tablist" aria-label="Input mode">
            <button
              id="mode_dataset"
              data-testid="mode-dataset-button"
              class="mode-btn is-active"
              role="tab"
              type="button"
              aria-selected="true"
              aria-controls="dataset_mode_panel"
            >
              Dataset file
            </button>
            <button
              id="mode_paste"
              data-testid="mode-paste-button"
              class="mode-btn"
              role="tab"
              type="button"
              aria-selected="false"
              aria-controls="paste_mode_panel"
            >
              Paste values
            </button>
          </div>

          <section id="dataset_mode_panel" class="mode-panel" role="tabpanel">
            <div class="dataset-grid">
              <label>Dataset CSV
                <input id="dataset_file" data-testid="dataset-file-input" type="file" accept=".csv,text/csv" />
              </label>
              <label>Date column (optional)
                <select id="dataset_date_col" data-testid="dataset-date-select"></select>
              </label>
              <label>Series 1 column
                <select id="dataset_ts1_col" data-testid="dataset-ts1-select"></select>
              </label>
              <label>Series 2 column
                <select id="dataset_ts2_col" data-testid="dataset-ts2-select"></select>
              </label>
            </div>
            <div class="actions dataset-actions">
              <button
                id="load_oni_example"
                data-testid="load-oni-example-button"
                class="btn secondary"
                type="button"
              >
                Load ONI example dataset
              </button>
            </div>
            <p id="dataset_meta" data-testid="dataset-meta" class="hint"></p>
            <details id="dataset_preview_details" data-testid="dataset-preview-details" class="preview-details" hidden>
              <summary id="dataset_preview_summary">Dataset preview</summary>
              <div class="table-wrap preview-wrap">
                <table id="dataset_preview_table" data-testid="dataset-preview-table">
                  <thead></thead>
                  <tbody></tbody>
                </table>
              </div>
            </details>
          </section>

          <section id="paste_mode_panel" class="mode-panel" role="tabpanel" hidden>
            <p class="hint">One number per line, or comma-separated values.</p>
            <div class="split paste-name-grid">
              <label>Series 1 name
                <input id="ts1_name" data-testid="paste-ts1-name-input" type="text" value="TS1" />
              </label>
              <label>Series 2 name
                <input id="ts2_name" data-testid="paste-ts2-name-input" type="text" value="TS2" />
              </label>
            </div>
            <div class="split">
              <label>Series 1
                <textarea id="ts1_text" rows="8" placeholder="0.11&#10;0.34&#10;0.28"></textarea>
              </label>
              <label>Series 2
                <textarea id="ts2_text" rows="8" placeholder="0.08&#10;0.26&#10;0.33"></textarea>
              </label>
            </div>
            <div class="actions">
              <button id="load_example" class="btn secondary" type="button">Load synthetic example</button>
            </div>
            <p id="paste_validation" data-testid="paste-validation" class="hint">Paste values to validate.</p>
          </section>
        </details>
      </article>

      <article class="card span-12 workflow-sdc" data-testid="analysis-settings-card">
        <details id="analysis_settings_details" data-testid="analysis-settings-details" class="settings-details" data-locked="true">
          <summary>Analysis Settings</summary>
          <div class="form-grid">
            <label>Fragment size
              <input id="fragment_size" data-testid="fragment-size-input" type="number" min="2" value="24" />
            </label>
            <label>Heatmap step
              <input id="heatmap_step" data-testid="heatmap-step-input" type="number" min="1" step="1" value="1" />
            </label>
            <label>Permutations
              <input id="n_permutations" data-testid="n-permutations-input" type="number" min="1" value="99" />
            </label>
            <label>Method
              <select id="method">
                <option value="pearson">pearson</option>
                <option value="spearman">spearman</option>
                <option value="kendall">kendall</option>
              </select>
            </label>
            <label>Min lag
              <input id="min_lag" data-testid="min-lag-input" type="number" value="-120" />
            </label>
            <label>Max lag
              <input id="max_lag" data-testid="max-lag-input" type="number" value="120" />
            </label>
            <label class="switch">Two-tailed test
              <input id="two_tailed" type="checkbox" checked />
            </label>
            <label class="switch">Permutation p-values
              <input id="permutations" type="checkbox" checked />
            </label>
          </div>
          <p id="heatmap_step_notice" data-testid="heatmap-step-notice" class="heatmap-step-alert" hidden>
            Reduce heatmap step at your own risk.
          </p>
        </details>
        <div class="actions settings-run-actions">
          <button id="submit_dataset" data-testid="dataset-run-button" class="btn" disabled>Run analysis</button>
        </div>
      </article>

      <article class="card span-12 status-banner hidden workflow-sdc" id="status_card" data-testid="status-card">
        <p id="status_text" data-testid="status-text"></p>
        <section class="status-progress" aria-label="Analysis progress">
          <div class="status-progress-meta">
            <span id="status_progress_label">Idle</span>
            <span id="status_progress_value">0%</span>
          </div>
          <div
            id="status_progress_track"
            class="status-progress-track"
            role="progressbar"
            aria-label="SDC analysis progress"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="0"
          >
            <span id="status_progress_fill" class="status-progress-fill"></span>
          </div>
        </section>
        <p id="status_error" class="error"></p>
      </article>

      <article class="card span-12 workflow-sdc" data-testid="explorer-card">
        <details id="explorer_details" data-testid="explorer-details" class="settings-details">
          <summary>2-Way SDC Explorer</summary>
          <div class="explorer-shell" id="workflow_sdc" role="tabpanel">
            <aside class="explorer-controls">
              <div class="plot-controls">
                <label class="range-field">Significance alpha
                  <div class="range-meta">
                    <input
                      id="plot_alpha"
                      data-testid="plot-alpha-input"
                      type="range"
                      step="0.001"
                      min="0"
                      max="1"
                      value="0.05"
                    />
                    <output id="plot_alpha_value" for="plot_alpha">0.050</output>
                  </div>
                </label>
                <label>Fragment size
                  <input
                    id="plot_fragment_size"
                    data-testid="plot-fragment-size-input"
                    type="number"
                    min="2"
                    value="24"
                  />
                </label>
                <label>Heatmap step
                  <input
                    id="plot_heatmap_step"
                    data-testid="plot-heatmap-step-input"
                    type="number"
                    min="1"
                    step="1"
                    value="1"
                  />
                </label>
                <button id="plot_apply" data-testid="plot-apply-button" class="btn" type="button">
                  Recompute
                </button>
                <p class="hint plot-controls-hint">
                  Alpha updates live. Changing fragment size or heatmap step re-runs analysis.
                </p>
              </div>
              <section class="explorer-downloads" aria-label="downloads">
                <h3>Download</h3>
                <div class="download-grid">
                  <button id="download_xlsx" class="download-tile" type="button" disabled>
                    <span class="download-ext">.xlsx</span>
                    <span class="download-label">Spread sheet</span>
                  </button>
                  <button id="download_png" class="download-tile" type="button" disabled>
                    <span class="download-ext">.png</span>
                    <span class="download-label">Raster image</span>
                  </button>
                  <button id="download_svg" class="download-tile" type="button" disabled>
                    <span class="download-ext">.svg</span>
                    <span class="download-label">Vector image</span>
                  </button>
                </div>
              </section>
            </aside>
            <div class="explorer-stage">
              <div id="two_way_explorer" data-testid="two-way-explorer" class="plot plot-large"></div>
            </div>
          </div>
        </details>
      </article>

      <article class="card span-12 workflow-sdc" id="summary_card" data-testid="summary-card">
        <h2>Summary</h2>
        <div id="summary_stats" data-testid="summary-stats" class="summary-grid"></div>
        <ul id="summary_notes" class="notes"></ul>
      </article>

      <article class="card span-12 workflow-map" data-testid="map-workflow-card" hidden>
        <details id="map_details" class="settings-details" open>
          <summary>SDC Map Explorer (beta)</summary>
          <p class="hint">
            Dedicated sdcpy-map workflow. Jobs are expensive; progress and ETA are shown while computing.
          </p>
          <div class="explorer-shell" id="workflow_map" role="tabpanel">
            <aside class="explorer-controls">
              <div class="plot-controls">
                <div class="map-controls-grid">
                  <label>Driver dataset
                    <select id="map_driver_dataset">
                      <option value="pdo">pdo</option>
                      <option value="nao">nao</option>
                      <option value="nino34">nino34</option>
                    </select>
                  </label>
                  <label>Field dataset
                    <select id="map_field_dataset">
                      <option value="ncep_air">ncep_air</option>
                      <option value="ersstv5_sst">ersstv5_sst</option>
                      <option value="oisst_v2_sst">oisst_v2_sst</option>
                    </select>
                  </label>
                  <label>Fragment size
                    <input id="map_fragment_size" type="number" min="2" value="12" />
                  </label>
                  <label>Significance alpha
                    <input id="map_alpha" type="number" min="0.001" max="0.999" step="0.001" value="0.05" />
                  </label>
                  <label>Top fraction
                    <input id="map_top_fraction" type="number" min="0.01" max="1" step="0.01" value="0.25" />
                  </label>
                  <label>Permutations
                    <input id="map_n_permutations" type="number" min="1" max="999" value="49" />
                  </label>
                  <label>Min lag
                    <input id="map_min_lag" type="number" value="-6" />
                  </label>
                  <label>Max lag
                    <input id="map_max_lag" type="number" value="6" />
                  </label>
                  <label>Time start
                    <input id="map_time_start" type="date" value="2010-01-01" />
                  </label>
                  <label>Time end
                    <input id="map_time_end" type="date" value="2023-12-01" />
                  </label>
                  <label>Peak date
                    <input id="map_peak_date" type="date" value="2015-01-01" />
                  </label>
                </div>
                <div class="map-action-row">
                  <button id="map_load" class="btn secondary" type="button">Load driver + dataset</button>
                  <button id="map_run" class="btn" type="button" disabled>Run SDC map</button>
                </div>
                <section class="map-progress" aria-label="Map job progress">
                  <div class="map-progress-meta">
                    <span id="map_progress_label">Idle</span>
                    <span id="map_progress_value">0%</span>
                  </div>
                  <div
                    id="map_progress_track"
                    class="map-progress-track"
                    role="progressbar"
                    aria-label="SDC map progress"
                    aria-valuemin="0"
                    aria-valuemax="100"
                    aria-valuenow="0"
                  >
                    <span id="map_progress_fill" class="map-progress-fill"></span>
                  </div>
                  <p id="map_progress_eta" class="hint map-progress-eta">Expected runtime: up to a few minutes.</p>
                </section>
                <p id="map_status" class="hint plot-controls-hint">
                  Load datasets to start the exploration phase.
                </p>
              </div>
            </aside>
            <div class="explorer-stage map-stage">
              <div id="map_phase_badge" class="map-phase-badge">Phase: idle</div>
              <div id="map_explore_controls" class="map-explore-controls" hidden>
                <label>Date frame
                  <input id="map_time_slider" type="range" min="0" max="0" step="1" value="0" />
                </label>
                <output id="map_time_slider_label">-</output>
              </div>
              <div id="map_result_tabs" class="map-result-tabs" role="tablist" aria-label="SDC map layers" hidden></div>
              <div class="map-results-shell">
                <div id="sdc_map_plot" class="plot map-plot" data-testid="sdc-map-plot"></div>
                <section class="explorer-downloads map-downloads-side" aria-label="map-downloads">
                  <h3>Download</h3>
                  <div class="download-grid map-download-grid">
                    <button id="map_download_png" class="download-tile" type="button" disabled>
                      <span class="download-ext">.png</span>
                      <span class="download-label">Matplotlib figure (4 layers)</span>
                    </button>
                    <button id="map_download_nc" class="download-tile" type="button" disabled>
                      <span class="download-ext">.nc</span>
                      <span class="download-label">Layer fields (NetCDF)</span>
                    </button>
                  </div>
                </section>
              </div>
              <p id="map_selected_cell" class="hint map-selected-cell"></p>
              <div id="sdc_map_summary" class="summary-grid summary-grid-map"></div>
            </div>
          </div>
        </details>
      </article>

    </section>
  </main>
</body>
</html>
